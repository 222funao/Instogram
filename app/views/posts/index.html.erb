<main>
<div class="feed">
  <% @posts.each do |post| %>
    <div class="post-card">
      <div class="post-header">
        <div class="post-user">
  <% if post.user.avatar.attached? %>
    <%= image_tag post.user.avatar,
      class: "avatar" %>
  <% end %>

  <strong>@<%= post.user.username %></strong>
</div>

      </div>
      
<% if post.media.attached? %>
  <div class="carousel" data-carousel>

    <% if post.media.count > 1 %>
      <button class="carousel-btn prev" type="button">‚Äπ</button>
    <% end %>

    <div class="carousel-track">
      <% post.media.each do |file| %>
        <div class="carousel-item">

          <div class="post-media-frame">
            <% if file.image? %>
              <%= image_tag file, class: "post-media" %>

         <% elsif file.video? %>
  <div class="video-wrapper post-media">
    <video
      class="post-media post-video"
      muted
      loop
      playsinline
      preload="metadata"
      data-video
    >
      <source src="<%= url_for(file) %>" type="<%= file.content_type %>">
    </video>

    <button class="mute-btn" type="button">üîá</button>
  </div>
<% end %>
          </div>

        </div>
      <% end %>
    </div>

    <% if post.media.count > 1 %>
      <button class="carousel-btn next" type="button">‚Ä∫</button>
    <% end %>

    <% if post.media.count > 1 %>
      <div class="carousel-dots">
        <% post.media.each_with_index do |_, index| %>
          <span
            class="dot <%= 'active' if index == 0 %>"
            data-index="<%= index %>">
          </span>
        <% end %>
      </div>
    <% end %>

  </div>
<% end %>






<div class="like-section">
  <% if post.liked_by?(current_user) %>
    <%= button_to post_like_path(post, post.likes.find_by(user: current_user)),
      method: :delete,
      class: "like-btn liked" do %>
      ‚ù§Ô∏è
    <% end %>
  <% else %>
    <%= button_to post_likes_path(post),
      method: :post,
      class: "like-btn" do %>
      ü§ç
    <% end %>
  <% end %>

  <span class="like-count">
    <%= post.likes.count %> likes
  </span>
</div>


      <div class="post-body">
        <div class="post-user">
  <% if post.user.avatar.attached? %>
    <%= image_tag post.user.avatar,
      class: "avatar" %>
  <% end %>

  <strong>@<%= post.user.username %></strong> <%= post.caption %></p>
</div>

 
      </div>

<div class="comments-section">
  <button class="toggle-comments-btn">
    Ver comentarios
  </button>
  <div class="comments-box hidden">
    <div class="comments">
      <% post.comments.each do |comment| %>
        <div class="comment">
          <span class="comment-user"><%= comment.user.username %></span>
          <span class="comment-text"><%= comment.content %></span>
          <% if comment.user == current_user %>
        <%= button_to "‚úñ",
          post_comment_path(post, comment),
          method: :delete,
          class: "comment-delete",
          form: { class: "inline" } %>
      <% end %>
        </div>
      <% end %>
    </div>
    <div class="comment-form">
  <%= form_with model: [post, Comment.new], local: true do |f| %>
    <%= f.text_field :content,
      placeholder: "A√±ade un comentario...",
      class: "comment-input" %>   
    <%= f.submit "Publicar",
      class: "comment-submit" %>
  <% end %>
</div>
  </div>

</div>



    </div>
  <% end %>
</div>
</main>